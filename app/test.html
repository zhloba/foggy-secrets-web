<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Test</title>
    <script>
        function toHexString(byteArray) {
            return Array.from(byteArray, function (byte) {
                return ('0' + (byte & 0xFF).toString(16)).slice(-2);
            }).join('')
        }

        function hexStringToByte(str) {
            if (!str) {
                return new Uint8Array();
            }

            var a = [];
            for (var i = 0, len = str.length; i < len; i += 2) {
                a.push(parseInt(str.substr(i, 2), 16));
            }

            return new Uint8Array(a);
        }

        function generateKey() {
            console.log(document.getElementById("password").value);
            var uint8arraypPassword = new TextEncoder("utf-8").encode(document.getElementById("password").value);
            console.log(uint8arraypPassword);

            window.crypto.subtle.importKey(
                "raw", //can be "jwk" or "raw"
                uint8arraypPassword,
                {   //this is the algorithm options
                    name: "HMAC",
                    hash: { name: "SHA-1" }, //can be "SHA-1", "SHA-256", "SHA-384", or "SHA-512"
                    //length: 256, //optional, if you want your key length to differ from the hash function's block length
                },
                false, //whether the key is extractable (i.e. can be used in exportKey)
                ["sign", "verify"] //can be any combination of "sign" and "verify"
            )
                .then(function (key) {
                    //returns the symmetric key
                    console.log(key);

                    window.crypto.subtle.sign(
                        {
                            name: "HMAC",
                        },
                        key, //from generateKey or importKey above
                        hexStringToByte("f91f3bc77d302e27c5e04ffab84cb3f801e4d541")
                        //new TextEncoder("utf-8").encode("plaindata") //ArrayBuffer of data you want to sign
                    )
                        .then(function (signature) {
                            //returns an ArrayBuffer containing the signature
                            document.getElementById("key").innerText = document.getElementById("key").innerText
                                + "\n data is signed (hmac) - ok";

                            console.log(new Uint8Array(signature));
                            console.log(toHexString(new Uint8Array(signature)));
                        })
                        .catch(function (err) {
                            console.error(err);
                        });

                })
                .catch(function (err) {
                    console.error(err);
                });


            // window.crypto.subtle.importKey(
            //     "raw", //only "raw" is allowed
            //     uint8arraypPassword, //your password
            //     {
            //         name: "PBKDF2",
            //     },
            //     false, //whether the key is extractable (i.e. can be used in exportKey)
            //     ["deriveKey", "deriveBits"] //can be any combination of "deriveKey" and "deriveBits"
            // )
            //     .then(function (key) {
            //         //returns a key object
            //         document.getElementById("key").innerText = "key is created - ok";
            //         console.log(key);


            //         window.crypto.subtle.deriveKey(
            //             {
            //                 "name": "PBKDF2",
            //                 salt: window.crypto.getRandomValues(new Uint8Array(16)),//new Uint8Array([21, 31, 41, 20, 66]),
            //                 iterations: 100,
            //                 hash: { name: "SHA-1" }, //can be "SHA-1", "SHA-256", "SHA-384", or "SHA-512"
            //             },
            //             key, //your key from generateKey or importKey
            //             { //the key type you want to create based on the derived bits
            //                 name: "HMAC", //can be any AES algorithm ("AES-CTR", "AES-CBC", "AES-CMAC", "AES-GCM", "AES-CFB", "AES-KW", "ECDH", "DH", or "HMAC")
            //                 //the generateKey parameters for that type of algorithm
            //                 //length: 256, //can be  128, 192, or 256
            //                 hash: { name: "SHA-1" }
            //             },
            //             false, //whether the derived key is extractable (i.e. can be used in exportKey)
            //             ["sign", "verify"] //limited to the options in that algorithm's importKey
            //         )
            //             .then(function (key) {
            //                 //returns the derived key

            //                 document.getElementById("key").innerText = document.getElementById("key").innerText
            //                     + "\n deriveKey is created - ok";
            //                 console.log(key);

            //                 window.crypto.subtle.sign(
            //                     {
            //                         name: "HMAC",
            //                     },
            //                     key, //from generateKey or importKey above
            //                     new TextEncoder("utf-8").encode("plaindata") //ArrayBuffer of data you want to sign
            //                 )
            //                     .then(function (signature) {
            //                         //returns an ArrayBuffer containing the signature
            //                         document.getElementById("key").innerText = document.getElementById("key").innerText
            //                             + "\n data is signed (hmac) - ok";

            //                         console.log(new Uint8Array(signature));
            //                     })
            //                     .catch(function (err) {
            //                         console.error(err);
            //                     });
            //             })
            //             .catch(function (err) {
            //                 console.error(err);
            //             });
            //     })
            //     .catch(function (err) {
            //         console.error(err);
            //     });
        }
    </script>

</head>

<body>
    <h1>Test</h1>
    <input id="password" type="text">
    <a href="#" onclick="generateKey()">Generate Key</a>
    <div id="key"></div>
</body>



</html>